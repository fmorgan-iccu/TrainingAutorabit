@IsTest
private class AOCRIFDecisionLogParserTest {

    @IsTest
    private static void testHappyPath() {
        String testData = '{"applicant":{"person":{"first_name":"Paul","last_name":"Ferguson","birth_date":"1958-01-01","tax_id":"666-37-1340","primary_address":{"line_1":"4400 Central Way","line_2":null,"city":"Chubbuck","state":"ID","country":"USA","postal_code":"83202"},"identification":{"type":"DriversLicense","id_number":"123456789","issuing_authority":"CO","issue_date":"1990-01-01","expire_date":"2020-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"7733504879","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"dmagill@gmail.com"},"persona":"Unknown","membership_eligibility":null,"system_info":[{"system_name":"CreateApp","system_display_name":"CRIF - CreateApp","status":"success","decision":"APPROVE","everything":"<s:Envelope xmlns:s=\\"http://schemas.xmlsoap.org/soap/envelope/\\"><s:Body xmlns:xsi=\\"http://www.w3.org/2001/XMLSchema-instance\\" xmlns:xsd=\\"http://www.w3.org/2001/XMLSchema\\"><SubmitExResponse xmlns=\\"http://tempuri.org/\\"><SubmitExResult><routing xmlns=\\"BizTalkMessage\\"><org orgID=\\"4\\" orgCode=\\"ICCU\\"/><action transactionType=\\"API\\"/><user userName=\\"ICCUImportUser\\"/><interface interfaceID=\\"600001\\"/><system/><approResult><result>Success</result></approResult></routing><body xmlns=\\"BizTalkMessage\\"><actionAPI version=\\"1\\" xmlns=\\"\\"><createApp><msg:appImportResponse msg:approVersion=\\"4.1\\" xmlns:msg=\\"Messages\\" xmlns:app=\\"App\\" xmlns:maint=\\"Maint\\" xmlns:util=\\"Util\\" xmlns:common=\\"Common\\"><msg:approResult><common:result>Success</common:result></msg:approResult><msg:appIDs><msg:appID>301001062</msg:appID></msg:appIDs><msg:applications><app:files/><app:application app:applicationID=\\"301001062\\" app:appNum=\\"301001062\\" app:appReceivedDate=\\"2019-12-13T10:34:06.486\\" app:appInitiatedDate=\\"2019-12-13T10:34:06.486\\" app:priorityCD=\\"High\\" app:deliveryMethodCD=\\"Internet\\" app:applicantStructureTypeCD=\\"Joint\\" app:referenceNumber=\\"AVOKA-DEV-becdfca2-11ff-428e-815e-121979ed7a13\\"><app:appParties><app:primaryBorrower common:idRef=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyType=\\"Individual\\"><app:appPartyResources><app:appPartyResource app:resourceID=\\"98\\"/></app:appPartyResources></app:primaryBorrower><app:borrower common:idRef=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyType=\\"Individual\\"><app:appPartyResources><app:appPartyResource app:resourceID=\\"98\\"/></app:appPartyResources></app:borrower><app:sourceChannel common:idRef=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:partyType=\\"Channel\\" app:appPartyType=\\"SourceChannel\\"/><app:servicingChannel common:idRef=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:partyType=\\"Channel\\" app:appPartyType=\\"ServicingChannel\\"/></app:appParties><app:parties><common:group common:id=\\"63836382-4c45-4313-afc7-a3750b1730e3\\" common:isNew=\\"false\\" common:partyID=\\"11878\\"><common:partyTypes><common:partyType>Team</common:partyType></common:partyTypes></common:group><common:employer common:id=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\" common:partyID=\\"2400330\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.4\\" common:name=\\"Test\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791968\\" common:contactMechanismType=\\"WorkPhone\\" common:contactString=\\"3081231234\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism></common:contactMechanisms></common:employer><common:channel common:id=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:isNew=\\"false\\" common:partyID=\\"12009\\"/><common:individual common:id=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyID=\\"2400328\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.247\\" common:ssn=\\"559595371\\" common:firstName=\\"Brianna\\" common:lastName=\\"Ridgway\\" common:dob=\\"1979-02-05\\" common:age=\\"40\\" common:mothersMaidenName=\\"null\\" common:isPermanentResidentFL=\\"false\\" common:hasAlienRegNumFL=\\"false\\" common:numOfDependants=\\"0\\" common:isExistingCustomerFL=\\"false\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791960\\" common:contactMechanismType=\\"CurrentAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791961\\" common:contactMechanismType=\\"MailingAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791962\\" common:contactMechanismType=\\"HomePhone\\" common:contactString=\\"3081212332\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791963\\" common:contactMechanismType=\\"EMail\\" common:contactString=\\"bridgway@iccu.com\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\"/></common:contactMechanism></common:contactMechanisms><common:partyRelationships><common:employment common:relationshipType=\\"Employment\\"><common:partyRef common:isNew=\\"true\\" common:idRef=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\" common:partyType=\\"Employer\\"/><common:employmentSubRel common:isNew=\\"false\\" common:isCurrentFL=\\"true\\" common:title=\\"Testinger\\" common:monthsEmployed=\\"47\\" common:employmentType=\\"FullTime\\"><common:userEmploymentType common:isNew=\\"false\\" common:CD=\\"2\\"/></common:employmentSubRel></common:employment></common:partyRelationships><common:partyIdentifications><common:partyIdentification common:IDNum=\\"180011210\\" common:dateOfIssuance=\\"2012-01-01T00:00:00\\" common:issuanceEntity=\\"CO\\" common:expirationDate=\\"2025-01-01T00:00:00\\" common:partyIdentificationID=\\"1540\\"><common:identificationCD common:isNew=\\"false\\" common:lookupType=\\"IdentificationType\\" common:CD=\\"D\\" common:name=\\"Drivers_License\\" common:isActive=\\"true\\"/></common:partyIdentification></common:partyIdentifications><common:incomes><common:income common:incomeID=\\"3725\\" common:IncomeTypeCD=\\"Salary\\" common:frequency=\\"Annually\\" common:amountPerPeriod=\\"50000.0\\" common:hoursPerWeek=\\"40\\" common:incomeStatus=\\"IncomeStatus_Included\\" common:incomeAdjustmentPercentage=\\"1\\"><common:employerRef common:isNew=\\"true\\" common:idRef=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\"/></common:income></common:incomes><common:trades><common:trade common:tradeID=\\"46399\\" common:accountTypeCD=\\"RealEstateMortgage\\" common:tradeTypeID=\\"Mortgage\\" common:creditorName=\\"\\" common:debtStatusCD=\\"Include\\" common:ecoaCD=\\"Individual\\" common:monthlyPayment=\\"500.0\\" common:isCurrResidenceRentMortgage=\\"true\\" common:isSecured=\\"true\\"><common:kindOfBusiness common:isNew=\\"false\\" common:lookupType=\\"KOB\\" common:CD=\\"FM\\"/></common:trade></common:trades></common:individual><common:user common:id=\\"801f914d-b637-41b3-af83-d9be2f8bb793\\" common:isNew=\\"false\\" common:partyID=\\"1493309\\" common:beginDate=\\"2018-08-09T09:28:40.737\\" common:timeZoneCode=\\"MST\\"><common:partyTypes><common:partyType>User</common:partyType><common:partyType>LoanOfficer</common:partyType></common:partyTypes></common:user><common:channel common:id=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:isNew=\\"false\\" common:partyID=\\"12009\\"/><common:organization common:id=\\"6b1fc6f4-5385-4669-8e8f-19041cc91924\\" common:isNew=\\"false\\" common:partyID=\\"4\\" common:name=\\"Idaho Central CU\\" common:description=\\"LoanCenter\\"><common:partyRelationships><common:partyRelationship common:relationshipType=\\"OrganizationToCustomerDataOwnership\\"><common:partyRef common:isNew=\\"false\\" common:idRef=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyType=\\"Individual\\"/></common:partyRelationship><common:partyRelationship common:relationshipType=\\"OrganizationToCustomerDataOwnership\\"><common:partyRef common:isNew=\\"false\\" common:idRef=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyType=\\"Individual\\"/></common:partyRelationship></common:partyRelationships></common:organization><common:employer common:id=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\" common:partyID=\\"2400331\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.4\\" common:name=\\"Testing\\"><common:contactMechanisms/></common:employer><common:individual common:id=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyID=\\"2400329\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.247\\" common:ssn=\\"666371340\\" common:firstName=\\"Paul\\" common:lastName=\\"Ferguson\\" common:dob=\\"1958-01-01\\" common:age=\\"61\\" common:mothersMaidenName=\\"null\\" common:isPermanentResidentFL=\\"false\\" common:hasAlienRegNumFL=\\"false\\" common:numOfDependants=\\"0\\" common:isExistingCustomerFL=\\"false\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791964\\" common:contactMechanismType=\\"CurrentAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791965\\" common:contactMechanismType=\\"MailingAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791966\\" common:contactMechanismType=\\"HomePhone\\" common:contactString=\\"7733504879\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791967\\" common:contactMechanismType=\\"EMail\\" common:contactString=\\"dmagill@gmail.com\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\"/></common:contactMechanism></common:contactMechanisms><common:partyRelationships><common:employment common:relationshipType=\\"Employment\\"><common:partyRef common:isNew=\\"true\\" common:idRef=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\" common:partyType=\\"Employer\\"/><common:employmentSubRel common:isNew=\\"false\\" common:isCurrentFL=\\"true\\" common:title=\\"Tester\\" common:monthsEmployed=\\"95\\" common:employmentType=\\"FullTime\\"><common:userEmploymentType common:isNew=\\"false\\" common:CD=\\"2\\"/></common:employmentSubRel></common:employment></common:partyRelationships><common:partyIdentifications><common:partyIdentification common:IDNum=\\"123456789\\" common:dateOfIssuance=\\"1990-01-01T00:00:00\\" common:issuanceEntity=\\"CO\\" common:expirationDate=\\"2020-01-01T00:00:00\\" common:partyIdentificationID=\\"1541\\"><common:identificationCD common:isNew=\\"false\\" common:lookupType=\\"IdentificationType\\" common:CD=\\"D\\" common:name=\\"Drivers_License\\" common:isActive=\\"true\\"/></common:partyIdentification></common:partyIdentifications><common:incomes><common:income common:incomeID=\\"3726\\" common:IncomeTypeCD=\\"Salary\\" common:frequency=\\"Annually\\" common:amountPerPeriod=\\"75000.0\\" common:hoursPerWeek=\\"40\\" common:incomeStatus=\\"IncomeStatus_Included\\" common:incomeAdjustmentPercentage=\\"1\\"><common:employerRef common:isNew=\\"true\\" common:idRef=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\"/></common:income></common:incomes><common:trades><common:trade common:tradeID=\\"46400\\" common:accountTypeCD=\\"RealEstateMortgage\\" common:tradeTypeID=\\"Mortgage\\" common:creditorName=\\"\\" common:debtStatusCD=\\"Include\\" common:ecoaCD=\\"Individual\\" common:monthlyPayment=\\"400.0\\" common:isCurrResidenceRentMortgage=\\"true\\" common:isSecured=\\"true\\"><common:kindOfBusiness common:isNew=\\"false\\" common:lookupType=\\"KOB\\" common:CD=\\"FM\\"/></common:trade></common:trades></common:individual></app:parties><app:appDetails><app:appDetailLOC app:appDetailID=\\"4276\\" app:appDetailSavePoint=\\"Current\\" app:contractDate=\\"2019-12-13T17:34:09.1016107\\" app:contractRate=\\"0.0200\\" app:financedAmt=\\"2500.0\\" app:equityPercentage=\\"0\\" app:termInMonths=\\"12\\" app:termFrequencyCD=\\"Monthly\\" app:daysPerYear=\\"360\\" app:calculationType=\\"OpenEnd\\" app:loanType=\\"Consumer\\" app:interestRateType=\\"Fixed\\" app:rankNum=\\"1\\" app:maxContractRate=\\"0.1799\\" app:minContractRate=\\"0.1799\\" app:baseRate=\\"0.18000000\\" app:insuranceOptionID=\\"1\\" app:paymentCalculationType=\\"PctOfAmountRequested\\" app:requestedAmtPaymentPct=\\"0.020\\"><app:appDetailParties><app:appDetailParty common:idRef=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:partyType=\\"Channel\\" app:appPartyType=\\"SourceChannel\\"/><app:appDetailParty common:idRef=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:partyType=\\"Channel\\" app:appPartyType=\\"ServicingChannel\\"/><app:appDetailParty common:idRef=\\"801f914d-b637-41b3-af83-d9be2f8bb793\\" common:partyType=\\"User\\" app:appPartyType=\\"LoanOfficer\\"/><app:appDetailParty common:idRef=\\"63836382-4c45-4313-afc7-a3750b1730e3\\" app:appPartyType=\\"QueuedFromUser\\"/></app:appDetailParties><app:appDetailRequestedAmts><app:appDetailRequestedAmt app:appDetailRequestedAmtID=\\"69526\\" app:requestedAmount=\\"2500.0\\" app:requestedAmountType=\\"Generic\\"/></app:appDetailRequestedAmts><app:appDetailStatuses><app:appDetailStatus app:appDetailStatusID=\\"14396\\" app:statusType=\\"WorkflowStatus\\" app:status=\\"WorkflowStatus_DataAcquisition\\"/></app:appDetailStatuses><app:product common:isNew=\\"false\\" common:productID=\\"117\\" common:beginDate=\\"2014-12-10T00:00:00\\" common:shortName=\\"PLOC\\" common:name=\\"Personal Line of Credit\\" common:isActiveFL=\\"true\\" common:productTypeID=\\"LOC\\" common:loanType=\\"Consumer\\" common:liquidCreditProductCategoryCD=\\"2100\\" common:orgID=\\"4\\"><common:organizationRef common:isNew=\\"false\\" common:idRef=\\"bcac6b22-19ff-4330-910b-429ebc0d2717\\"/><common:productCategory common:isNew=\\"false\\" common:productCategoryID=\\"22\\" common:name=\\"Direct Products\\" common:description=\\"Direct Products\\" common:isActiveFL=\\"true\\"><common:organizationRef common:isNew=\\"false\\" common:idRef=\\"bcac6b22-19ff-4330-910b-429ebc0d2717\\"/></common:productCategory><common:initialTeamRef common:isNew=\\"false\\" common:idRef=\\"d85edbc0-b4f9-41a8-bf96-a9b4d0013f76\\"/><common:productFormPackage common:isNew=\\"false\\" common:CD=\\"2\\" common:name=\\"LOC / HELOC\\" common:formPackageTypeID=\\"1\\"/></app:product><app:appDetailStipulations><app:appDetailStipulation app:appDetailStipulationID=\\"37904\\" app:status=\\"Open\\" app:name=\\"Duplicate Fraud Alerts:  Select satisfied if a trigger happened and it was addressed in notes.  Select waived if an alert did not trigger.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"16\\" common:name=\\"Duplicate Fraud Alerts:  Select satisfied if a trigger happened and it was addressed in notes.  Select waived if an alert did not trigger.\\" common:sortOrder=\\"0\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37905\\" app:status=\\"Open\\" app:name=\\"Employment Income Verification:  Select satisfied if verification was obtained and/or documented or imaged.  Select waived if the loan meets guidelines to waive verification.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"17\\" common:name=\\"Employment Income Verification:  Select satisfied if verification was obtained and/or documented or imaged.  Select waived if the loan meets guidelines to waive verification.\\" common:sortOrder=\\"1\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37906\\" app:status=\\"Open\\" app:name=\\"Loan Aggregates:  Select satisfied if the loan needs to go to Loan Committee for approval due to aggregates.  Select waived if the loan does not need to go to Loan Committee due to aggregates.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"18\\" common:name=\\"Loan Aggregates:  Select satisfied if the loan needs to go to Loan Committee for approval due to aggregates.  Select waived if the loan does not need to go to Loan Committee due to aggregates.\\" common:sortOrder=\\"2\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37907\\" app:status=\\"Open\\" app:name=\\"Verify Primary Borrower is Tax Owner on Share\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"77\\" common:name=\\"Verify Primary Borrower is Tax Owner on Share\\" common:sortOrder=\\"3\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation></app:appDetailStipulations><app:riskProcessingLevel common:isNew=\\"false\\" common:lookupType=\\"RPL\\" common:CD=\\"1\\"/><app:fields><common:lookupFieldLink common:value=\\"210\\"><common:customLookupField common:isNew=\\"false\\" common:name=\\"Does primary applicant have a valid email address?\\" common:ID=\\"-127\\" common:fieldLevel=\\"ProductCategory\\"/></common:lookupFieldLink></app:fields><app:pricingPlan common:isNew=\\"false\\" common:planID=\\"14\\"/><app:appDetailIndirect common:isNew=\\"false\\" app:payDealerNow=\\"false\\" app:payOriginationFeeNow=\\"false\\" app:calcOriginationFeeFL=\\"false\\" app:useCRBRRuleFL=\\"false\\" app:isOriginationFeeValuePct=\\"false\\" app:calcDiscountFL=\\"false\\" app:globalDiscountFL=\\"true\\" app:federalDisclosureFL=\\"false\\"/><app:loanPurposes><app:appDetailLoanPurpose app:rank=\\"1\\"><app:loanPurpose common:isNew=\\"false\\" common:CD=\\"137\\"/></app:appDetailLoanPurpose></app:loanPurposes><app:contractRateIndex common:isNew=\\"true\\" common:rateIndexID=\\"4\\"/><app:appDetailProcessQuestionResponses><app:appDetailQuestionResponse app:appDetailQuestionResponseID=\\"12533\\" app:processID=\\"51\\" app:ordernum=\\"0\\"><app:question common:isNew=\\"false\\" common:questionID=\\"86\\"/><app:lookupResponse common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailQuestionResponse></app:appDetailProcessQuestionResponses></app:appDetailLOC></app:appDetails><app:properties/><app:addresses><common:address common:id=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\" common:addressID=\\"3188091\\" common:street1=\\"4400 Central Way\\" common:street2=\\"\\" common:postalCode=\\"83202\\" common:cityName=\\"Chubbuck\\" common:monthsResided=\\"95\\" common:state=\\"ID\\" common:country=\\"UnitedStates\\"><common:residenceType common:isNew=\\"false\\" common:CD=\\"Rent\\"/></common:address><common:address common:id=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\" common:addressID=\\"3188092\\" common:street1=\\"4400 Central Way\\" common:street2=\\"\\" common:postalCode=\\"83202\\" common:cityName=\\"Chubbuck\\" common:monthsResided=\\"59\\" common:state=\\"ID\\" common:country=\\"UnitedStates\\"><common:residenceType common:isNew=\\"false\\" common:CD=\\"Rent\\"/></common:address></app:addresses><app:scores/><app:org common:isNew=\\"false\\" common:idRef=\\"6b1fc6f4-5385-4669-8e8f-19041cc91924\\"/><app:appServiceRequests/><app:vehicleValuations/><app:deliverySource common:isNew=\\"false\\" common:CD=\\"600001\\"/><app:serviceRequestGroups/></app:application></msg:applications></msg:appImportResponse></createApp></actionAPI></body></SubmitExResult></SubmitExResponse></s:Body></s:Envelope>","user_action":"","tracking_number":"XW3WXBZ"},{"system_name":"CrifDecisioning","system_display_name":"CRIF - Decisioning","status":"success","decision":"APPROVE","everything":"<s:Envelope xmlns:s=\\"http://schemas.xmlsoap.org/soap/envelope/\\"><s:Body xmlns:xsi=\\"http://www.w3.org/2001/XMLSchema-instance\\" xmlns:xsd=\\"http://www.w3.org/2001/XMLSchema\\"><SubmitExResponse xmlns=\\"http://tempuri.org/\\"><SubmitExResult><routing xmlns=\\"BizTalkMessage\\"><org orgID=\\"4\\" orgCode=\\"ICCU\\"/><action transactionType=\\"API\\"/><user userName=\\"ICCUImportUser\\"/><interface interfaceID=\\"600001\\"/><system/><approResult><result>Success</result></approResult></routing><body xmlns=\\"BizTalkMessage\\"><actionAPI version=\\"1\\" xmlns=\\"\\"><sendToDecisioning><msg:appImportResponse msg:approVersion=\\"4.1\\" xmlns:msg=\\"Messages\\" xmlns:app=\\"App\\" xmlns:maint=\\"Maint\\" xmlns:util=\\"Util\\" xmlns:common=\\"Common\\"><msg:approResult><common:result>Success</common:result></msg:approResult><msg:appIDs><msg:appID>301001062</msg:appID></msg:appIDs><msg:applications><app:files/><app:application common:isNew=\\"false\\" app:applicationID=\\"301001062\\"><app:parties/><app:appDetails/><app:properties/><app:addresses/><app:scores/><app:appServiceRequests/><app:vehicleValuations/><app:serviceRequestGroups/></app:application></msg:applications></msg:appImportResponse></sendToDecisioning></actionAPI></body></SubmitExResult></SubmitExResponse></s:Body></s:Envelope>","user_action":"","tracking_number":"XW3WXBZ"}]},"coApplicants":[{"person":{"first_name":"Brianna","last_name":"Ridgway","birth_date":"1979-02-05","primary_address":{"line_1":null,"line_2":null,"city":null,"state":null,"country":"USA","postal_code":null},"identification":{"type":"DriversLicense","id_number":"180011210","issuing_authority":"CO","issue_date":"2012-01-01","expire_date":"2025-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"3081212332","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"bridgway@iccu.com"},"persona":null}],"products":[{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}],"fundingInfo":{"from_account_uuid":null,"payment_type":null,"is_using_external_processor":null,"opened_accounts":[{"account":{"unique_id":"0fe157d2-3000-4341-b955-370e5bab8a49","account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":null,"funding_source":null}]},"reports":[],"app_status":"complete","version":"3","external_crm_id":null,"promotions":[],"form":{"name":"Disclosures and Signatures","tracking_code":"9F6WQG2","job_reference_code":"S4ZS5FM","url":"https://dev.iccu.avoka-transact.com/apps/secure/form.htm?submitKey=200e62d7f7d827b714e719a21190c4e8"}}';
        AOApplicationRestRequest request = AOApplicationRestRequest.parse(testData);
        AOApplicationInfo appInfo = new AOApplicationInfo(request);

        Test.startTest();

        AOCRIFDecisionLogParser parser = new AOCRIFDecisionLogParser();
        try {
            parser.parsePayload(request.applicant.system_info, appInfo);
        } catch(Exception e) {
            System.assert(false, 'Threw an exception: ' + e + ' stack trace: ' + e.getStackTraceString());
        }

        Test.stopTest();

        String systemName = parser.getSystemName();
        AOInteractionResult result = appInfo.systemInteractionResults.get(systemName);

        System.assertNotEquals(null, result);
        System.assertEquals(AOInteractionResult.State.SUCCESS, result.state);
        System.assertNotEquals(null, appInfo.loanApplicationIds);
        System.assertEquals(0, appInfo.errors.size(), 'Error: ' + appInfo.errors);
        System.assertEquals(1, appInfo.loanApplicationIds.size());
        System.assertEquals('301001062', appInfo.loanApplicationIds[0]);
    }

    @IsTest
    private static void testMissingEverything() {
        String testData = '{"applicant":{"person":{"first_name":"Paul","last_name":"Ferguson","birth_date":"1958-01-01","tax_id":"666-37-1340","primary_address":{"line_1":"4400 Central Way","line_2":null,"city":"Chubbuck","state":"ID","country":"USA","postal_code":"83202"},"identification":{"type":"DriversLicense","id_number":"123456789","issuing_authority":"CO","issue_date":"1990-01-01","expire_date":"2020-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"7733504879","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"dmagill@gmail.com"},"persona":"Unknown","membership_eligibility":null,"system_info":[{"system_name":"CreateApp","system_display_name":"CRIF - CreateApp","status":"success","decision":"APPROVE","everything":"<s:Envelope xmlns:s=\\"http://schemas.xmlsoap.org/soap/envelope/\\"><s:Body xmlns:xsi=\\"http://www.w3.org/2001/XMLSchema-instance\\" xmlns:xsd=\\"http://www.w3.org/2001/XMLSchema\\"><SubmitExResponse xmlns=\\"http://tempuri.org/\\"><SubmitExResult><routing xmlns=\\"BizTalkMessage\\"><org orgID=\\"4\\" orgCode=\\"ICCU\\"/><action transactionType=\\"API\\"/><user userName=\\"ICCUImportUser\\"/><interface interfaceID=\\"600001\\"/><system/><approResult><result>Success</result></approResult></routing><body xmlns=\\"BizTalkMessage\\"><actionAPI version=\\"1\\" xmlns=\\"\\"><createApp><msg:appImportResponse msg:approVersion=\\"4.1\\" xmlns:msg=\\"Messages\\" xmlns:app=\\"App\\" xmlns:maint=\\"Maint\\" xmlns:util=\\"Util\\" xmlns:common=\\"Common\\"><msg:approResult><common:result>Success</common:result></msg:approResult><msg:appIDs><msg:appID>301001062</msg:appID></msg:appIDs><msg:applications><app:files/><app:application app:applicationID=\\"301001062\\" app:appNum=\\"301001062\\" app:appReceivedDate=\\"2019-12-13T10:34:06.486\\" app:appInitiatedDate=\\"2019-12-13T10:34:06.486\\" app:priorityCD=\\"High\\" app:deliveryMethodCD=\\"Internet\\" app:applicantStructureTypeCD=\\"Joint\\" app:referenceNumber=\\"AVOKA-DEV-becdfca2-11ff-428e-815e-121979ed7a13\\"><app:appParties><app:primaryBorrower common:idRef=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyType=\\"Individual\\"><app:appPartyResources><app:appPartyResource app:resourceID=\\"98\\"/></app:appPartyResources></app:primaryBorrower><app:borrower common:idRef=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyType=\\"Individual\\"><app:appPartyResources><app:appPartyResource app:resourceID=\\"98\\"/></app:appPartyResources></app:borrower><app:sourceChannel common:idRef=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:partyType=\\"Channel\\" app:appPartyType=\\"SourceChannel\\"/><app:servicingChannel common:idRef=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:partyType=\\"Channel\\" app:appPartyType=\\"ServicingChannel\\"/></app:appParties><app:parties><common:group common:id=\\"63836382-4c45-4313-afc7-a3750b1730e3\\" common:isNew=\\"false\\" common:partyID=\\"11878\\"><common:partyTypes><common:partyType>Team</common:partyType></common:partyTypes></common:group><common:employer common:id=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\" common:partyID=\\"2400330\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.4\\" common:name=\\"Test\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791968\\" common:contactMechanismType=\\"WorkPhone\\" common:contactString=\\"3081231234\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism></common:contactMechanisms></common:employer><common:channel common:id=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:isNew=\\"false\\" common:partyID=\\"12009\\"/><common:individual common:id=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyID=\\"2400328\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.247\\" common:ssn=\\"559595371\\" common:firstName=\\"Brianna\\" common:lastName=\\"Ridgway\\" common:dob=\\"1979-02-05\\" common:age=\\"40\\" common:mothersMaidenName=\\"null\\" common:isPermanentResidentFL=\\"false\\" common:hasAlienRegNumFL=\\"false\\" common:numOfDependants=\\"0\\" common:isExistingCustomerFL=\\"false\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791960\\" common:contactMechanismType=\\"CurrentAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791961\\" common:contactMechanismType=\\"MailingAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791962\\" common:contactMechanismType=\\"HomePhone\\" common:contactString=\\"3081212332\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791963\\" common:contactMechanismType=\\"EMail\\" common:contactString=\\"bridgway@iccu.com\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\"/></common:contactMechanism></common:contactMechanisms><common:partyRelationships><common:employment common:relationshipType=\\"Employment\\"><common:partyRef common:isNew=\\"true\\" common:idRef=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\" common:partyType=\\"Employer\\"/><common:employmentSubRel common:isNew=\\"false\\" common:isCurrentFL=\\"true\\" common:title=\\"Testinger\\" common:monthsEmployed=\\"47\\" common:employmentType=\\"FullTime\\"><common:userEmploymentType common:isNew=\\"false\\" common:CD=\\"2\\"/></common:employmentSubRel></common:employment></common:partyRelationships><common:partyIdentifications><common:partyIdentification common:IDNum=\\"180011210\\" common:dateOfIssuance=\\"2012-01-01T00:00:00\\" common:issuanceEntity=\\"CO\\" common:expirationDate=\\"2025-01-01T00:00:00\\" common:partyIdentificationID=\\"1540\\"><common:identificationCD common:isNew=\\"false\\" common:lookupType=\\"IdentificationType\\" common:CD=\\"D\\" common:name=\\"Drivers_License\\" common:isActive=\\"true\\"/></common:partyIdentification></common:partyIdentifications><common:incomes><common:income common:incomeID=\\"3725\\" common:IncomeTypeCD=\\"Salary\\" common:frequency=\\"Annually\\" common:amountPerPeriod=\\"50000.0\\" common:hoursPerWeek=\\"40\\" common:incomeStatus=\\"IncomeStatus_Included\\" common:incomeAdjustmentPercentage=\\"1\\"><common:employerRef common:isNew=\\"true\\" common:idRef=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\"/></common:income></common:incomes><common:trades><common:trade common:tradeID=\\"46399\\" common:accountTypeCD=\\"RealEstateMortgage\\" common:tradeTypeID=\\"Mortgage\\" common:creditorName=\\"\\" common:debtStatusCD=\\"Include\\" common:ecoaCD=\\"Individual\\" common:monthlyPayment=\\"500.0\\" common:isCurrResidenceRentMortgage=\\"true\\" common:isSecured=\\"true\\"><common:kindOfBusiness common:isNew=\\"false\\" common:lookupType=\\"KOB\\" common:CD=\\"FM\\"/></common:trade></common:trades></common:individual><common:user common:id=\\"801f914d-b637-41b3-af83-d9be2f8bb793\\" common:isNew=\\"false\\" common:partyID=\\"1493309\\" common:beginDate=\\"2018-08-09T09:28:40.737\\" common:timeZoneCode=\\"MST\\"><common:partyTypes><common:partyType>User</common:partyType><common:partyType>LoanOfficer</common:partyType></common:partyTypes></common:user><common:channel common:id=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:isNew=\\"false\\" common:partyID=\\"12009\\"/><common:organization common:id=\\"6b1fc6f4-5385-4669-8e8f-19041cc91924\\" common:isNew=\\"false\\" common:partyID=\\"4\\" common:name=\\"Idaho Central CU\\" common:description=\\"LoanCenter\\"><common:partyRelationships><common:partyRelationship common:relationshipType=\\"OrganizationToCustomerDataOwnership\\"><common:partyRef common:isNew=\\"false\\" common:idRef=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyType=\\"Individual\\"/></common:partyRelationship><common:partyRelationship common:relationshipType=\\"OrganizationToCustomerDataOwnership\\"><common:partyRef common:isNew=\\"false\\" common:idRef=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyType=\\"Individual\\"/></common:partyRelationship></common:partyRelationships></common:organization><common:employer common:id=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\" common:partyID=\\"2400331\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.4\\" common:name=\\"Testing\\"><common:contactMechanisms/></common:employer><common:individual common:id=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyID=\\"2400329\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.247\\" common:ssn=\\"666371340\\" common:firstName=\\"Paul\\" common:lastName=\\"Ferguson\\" common:dob=\\"1958-01-01\\" common:age=\\"61\\" common:mothersMaidenName=\\"null\\" common:isPermanentResidentFL=\\"false\\" common:hasAlienRegNumFL=\\"false\\" common:numOfDependants=\\"0\\" common:isExistingCustomerFL=\\"false\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791964\\" common:contactMechanismType=\\"CurrentAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791965\\" common:contactMechanismType=\\"MailingAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791966\\" common:contactMechanismType=\\"HomePhone\\" common:contactString=\\"7733504879\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791967\\" common:contactMechanismType=\\"EMail\\" common:contactString=\\"dmagill@gmail.com\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\"/></common:contactMechanism></common:contactMechanisms><common:partyRelationships><common:employment common:relationshipType=\\"Employment\\"><common:partyRef common:isNew=\\"true\\" common:idRef=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\" common:partyType=\\"Employer\\"/><common:employmentSubRel common:isNew=\\"false\\" common:isCurrentFL=\\"true\\" common:title=\\"Tester\\" common:monthsEmployed=\\"95\\" common:employmentType=\\"FullTime\\"><common:userEmploymentType common:isNew=\\"false\\" common:CD=\\"2\\"/></common:employmentSubRel></common:employment></common:partyRelationships><common:partyIdentifications><common:partyIdentification common:IDNum=\\"123456789\\" common:dateOfIssuance=\\"1990-01-01T00:00:00\\" common:issuanceEntity=\\"CO\\" common:expirationDate=\\"2020-01-01T00:00:00\\" common:partyIdentificationID=\\"1541\\"><common:identificationCD common:isNew=\\"false\\" common:lookupType=\\"IdentificationType\\" common:CD=\\"D\\" common:name=\\"Drivers_License\\" common:isActive=\\"true\\"/></common:partyIdentification></common:partyIdentifications><common:incomes><common:income common:incomeID=\\"3726\\" common:IncomeTypeCD=\\"Salary\\" common:frequency=\\"Annually\\" common:amountPerPeriod=\\"75000.0\\" common:hoursPerWeek=\\"40\\" common:incomeStatus=\\"IncomeStatus_Included\\" common:incomeAdjustmentPercentage=\\"1\\"><common:employerRef common:isNew=\\"true\\" common:idRef=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\"/></common:income></common:incomes><common:trades><common:trade common:tradeID=\\"46400\\" common:accountTypeCD=\\"RealEstateMortgage\\" common:tradeTypeID=\\"Mortgage\\" common:creditorName=\\"\\" common:debtStatusCD=\\"Include\\" common:ecoaCD=\\"Individual\\" common:monthlyPayment=\\"400.0\\" common:isCurrResidenceRentMortgage=\\"true\\" common:isSecured=\\"true\\"><common:kindOfBusiness common:isNew=\\"false\\" common:lookupType=\\"KOB\\" common:CD=\\"FM\\"/></common:trade></common:trades></common:individual></app:parties><app:appDetails><app:appDetailLOC app:appDetailID=\\"4276\\" app:appDetailSavePoint=\\"Current\\" app:contractDate=\\"2019-12-13T17:34:09.1016107\\" app:contractRate=\\"0.0200\\" app:financedAmt=\\"2500.0\\" app:equityPercentage=\\"0\\" app:termInMonths=\\"12\\" app:termFrequencyCD=\\"Monthly\\" app:daysPerYear=\\"360\\" app:calculationType=\\"OpenEnd\\" app:loanType=\\"Consumer\\" app:interestRateType=\\"Fixed\\" app:rankNum=\\"1\\" app:maxContractRate=\\"0.1799\\" app:minContractRate=\\"0.1799\\" app:baseRate=\\"0.18000000\\" app:insuranceOptionID=\\"1\\" app:paymentCalculationType=\\"PctOfAmountRequested\\" app:requestedAmtPaymentPct=\\"0.020\\"><app:appDetailParties><app:appDetailParty common:idRef=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:partyType=\\"Channel\\" app:appPartyType=\\"SourceChannel\\"/><app:appDetailParty common:idRef=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:partyType=\\"Channel\\" app:appPartyType=\\"ServicingChannel\\"/><app:appDetailParty common:idRef=\\"801f914d-b637-41b3-af83-d9be2f8bb793\\" common:partyType=\\"User\\" app:appPartyType=\\"LoanOfficer\\"/><app:appDetailParty common:idRef=\\"63836382-4c45-4313-afc7-a3750b1730e3\\" app:appPartyType=\\"QueuedFromUser\\"/></app:appDetailParties><app:appDetailRequestedAmts><app:appDetailRequestedAmt app:appDetailRequestedAmtID=\\"69526\\" app:requestedAmount=\\"2500.0\\" app:requestedAmountType=\\"Generic\\"/></app:appDetailRequestedAmts><app:appDetailStatuses><app:appDetailStatus app:appDetailStatusID=\\"14396\\" app:statusType=\\"WorkflowStatus\\" app:status=\\"WorkflowStatus_DataAcquisition\\"/></app:appDetailStatuses><app:product common:isNew=\\"false\\" common:productID=\\"117\\" common:beginDate=\\"2014-12-10T00:00:00\\" common:shortName=\\"PLOC\\" common:name=\\"Personal Line of Credit\\" common:isActiveFL=\\"true\\" common:productTypeID=\\"LOC\\" common:loanType=\\"Consumer\\" common:liquidCreditProductCategoryCD=\\"2100\\" common:orgID=\\"4\\"><common:organizationRef common:isNew=\\"false\\" common:idRef=\\"bcac6b22-19ff-4330-910b-429ebc0d2717\\"/><common:productCategory common:isNew=\\"false\\" common:productCategoryID=\\"22\\" common:name=\\"Direct Products\\" common:description=\\"Direct Products\\" common:isActiveFL=\\"true\\"><common:organizationRef common:isNew=\\"false\\" common:idRef=\\"bcac6b22-19ff-4330-910b-429ebc0d2717\\"/></common:productCategory><common:initialTeamRef common:isNew=\\"false\\" common:idRef=\\"d85edbc0-b4f9-41a8-bf96-a9b4d0013f76\\"/><common:productFormPackage common:isNew=\\"false\\" common:CD=\\"2\\" common:name=\\"LOC / HELOC\\" common:formPackageTypeID=\\"1\\"/></app:product><app:appDetailStipulations><app:appDetailStipulation app:appDetailStipulationID=\\"37904\\" app:status=\\"Open\\" app:name=\\"Duplicate Fraud Alerts:  Select satisfied if a trigger happened and it was addressed in notes.  Select waived if an alert did not trigger.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"16\\" common:name=\\"Duplicate Fraud Alerts:  Select satisfied if a trigger happened and it was addressed in notes.  Select waived if an alert did not trigger.\\" common:sortOrder=\\"0\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37905\\" app:status=\\"Open\\" app:name=\\"Employment Income Verification:  Select satisfied if verification was obtained and/or documented or imaged.  Select waived if the loan meets guidelines to waive verification.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"17\\" common:name=\\"Employment Income Verification:  Select satisfied if verification was obtained and/or documented or imaged.  Select waived if the loan meets guidelines to waive verification.\\" common:sortOrder=\\"1\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37906\\" app:status=\\"Open\\" app:name=\\"Loan Aggregates:  Select satisfied if the loan needs to go to Loan Committee for approval due to aggregates.  Select waived if the loan does not need to go to Loan Committee due to aggregates.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"18\\" common:name=\\"Loan Aggregates:  Select satisfied if the loan needs to go to Loan Committee for approval due to aggregates.  Select waived if the loan does not need to go to Loan Committee due to aggregates.\\" common:sortOrder=\\"2\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37907\\" app:status=\\"Open\\" app:name=\\"Verify Primary Borrower is Tax Owner on Share\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"77\\" common:name=\\"Verify Primary Borrower is Tax Owner on Share\\" common:sortOrder=\\"3\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation></app:appDetailStipulations><app:riskProcessingLevel common:isNew=\\"false\\" common:lookupType=\\"RPL\\" common:CD=\\"1\\"/><app:fields><common:lookupFieldLink common:value=\\"210\\"><common:customLookupField common:isNew=\\"false\\" common:name=\\"Does primary applicant have a valid email address?\\" common:ID=\\"-127\\" common:fieldLevel=\\"ProductCategory\\"/></common:lookupFieldLink></app:fields><app:pricingPlan common:isNew=\\"false\\" common:planID=\\"14\\"/><app:appDetailIndirect common:isNew=\\"false\\" app:payDealerNow=\\"false\\" app:payOriginationFeeNow=\\"false\\" app:calcOriginationFeeFL=\\"false\\" app:useCRBRRuleFL=\\"false\\" app:isOriginationFeeValuePct=\\"false\\" app:calcDiscountFL=\\"false\\" app:globalDiscountFL=\\"true\\" app:federalDisclosureFL=\\"false\\"/><app:loanPurposes><app:appDetailLoanPurpose app:rank=\\"1\\"><app:loanPurpose common:isNew=\\"false\\" common:CD=\\"137\\"/></app:appDetailLoanPurpose></app:loanPurposes><app:contractRateIndex common:isNew=\\"true\\" common:rateIndexID=\\"4\\"/><app:appDetailProcessQuestionResponses><app:appDetailQuestionResponse app:appDetailQuestionResponseID=\\"12533\\" app:processID=\\"51\\" app:ordernum=\\"0\\"><app:question common:isNew=\\"false\\" common:questionID=\\"86\\"/><app:lookupResponse common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailQuestionResponse></app:appDetailProcessQuestionResponses></app:appDetailLOC></app:appDetails><app:properties/><app:addresses><common:address common:id=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\" common:addressID=\\"3188091\\" common:street1=\\"4400 Central Way\\" common:street2=\\"\\" common:postalCode=\\"83202\\" common:cityName=\\"Chubbuck\\" common:monthsResided=\\"95\\" common:state=\\"ID\\" common:country=\\"UnitedStates\\"><common:residenceType common:isNew=\\"false\\" common:CD=\\"Rent\\"/></common:address><common:address common:id=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\" common:addressID=\\"3188092\\" common:street1=\\"4400 Central Way\\" common:street2=\\"\\" common:postalCode=\\"83202\\" common:cityName=\\"Chubbuck\\" common:monthsResided=\\"59\\" common:state=\\"ID\\" common:country=\\"UnitedStates\\"><common:residenceType common:isNew=\\"false\\" common:CD=\\"Rent\\"/></common:address></app:addresses><app:scores/><app:org common:isNew=\\"false\\" common:idRef=\\"6b1fc6f4-5385-4669-8e8f-19041cc91924\\"/><app:appServiceRequests/><app:vehicleValuations/><app:deliverySource common:isNew=\\"false\\" common:CD=\\"600001\\"/><app:serviceRequestGroups/></app:application></msg:applications></msg:appImportResponse></createApp></actionAPI></body></SubmitExResult></SubmitExResponse></s:Body></s:Envelope>","user_action":"","tracking_number":"XW3WXBZ"},{"system_name":"CrifDecisioning","system_display_name":"CRIF - Decisioning","status":"success","decision":"APPROVE","everything":"","user_action":"","tracking_number":"XW3WXBZ"}]},"coApplicants":[{"person":{"first_name":"Brianna","last_name":"Ridgway","birth_date":"1979-02-05","primary_address":{"line_1":null,"line_2":null,"city":null,"state":null,"country":"USA","postal_code":null},"identification":{"type":"DriversLicense","id_number":"180011210","issuing_authority":"CO","issue_date":"2012-01-01","expire_date":"2025-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"3081212332","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"bridgway@iccu.com"},"persona":null}],"products":[{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}],"fundingInfo":{"from_account_uuid":null,"payment_type":null,"is_using_external_processor":null,"opened_accounts":[{"account":{"unique_id":"0fe157d2-3000-4341-b955-370e5bab8a49","account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":null,"funding_source":null}]},"reports":[],"app_status":"complete","version":"3","external_crm_id":null,"promotions":[],"form":{"name":"Disclosures and Signatures","tracking_code":"9F6WQG2","job_reference_code":"S4ZS5FM","url":"https://dev.iccu.avoka-transact.com/apps/secure/form.htm?submitKey=200e62d7f7d827b714e719a21190c4e8"}}';
        AOApplicationRestRequest request = AOApplicationRestRequest.parse(testData);
        AOApplicationInfo appInfo = new AOApplicationInfo(request);

        Test.startTest();

        AOCRIFDecisionLogParser parser = new AOCRIFDecisionLogParser();
        try {
            parser.parsePayload(request.applicant.system_info, appInfo);
        } catch(Exception e) {
            System.assert(false, 'Threw an exception: ' + e + ' stack trace: ' + e.getStackTraceString());
        }

        Test.stopTest();

        String systemName = parser.getSystemName();
        AOInteractionResult result = appInfo.systemInteractionResults.get(systemName);

        System.assertNotEquals(null, result);
        System.assertEquals(AOInteractionResult.State.ERROR, result.state);
        System.assertEquals(null, appInfo.loanApplicationIds);
        System.assertEquals(0, appInfo.errors.size(), 'Error: ' + appInfo.errors);
    }

    @IsTest
    private static void testErrors() {
        String testData = '{"applicant":{"person":{"first_name":"Paul","last_name":"Ferguson","birth_date":"1958-01-01","tax_id":"666-37-1340","primary_address":{"line_1":"4400 Central Way","line_2":null,"city":"Chubbuck","state":"ID","country":"USA","postal_code":"83202"},"identification":{"type":"DriversLicense","id_number":"123456789","issuing_authority":"CO","issue_date":"1990-01-01","expire_date":"2020-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"7733504879","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"dmagill@gmail.com"},"persona":"Unknown","membership_eligibility":null,"system_info":[{"system_name":"CreateApp","system_display_name":"CRIF - CreateApp","status":"success","decision":"APPROVE","everything":"<s:Envelope xmlns:s=\\"http://schemas.xmlsoap.org/soap/envelope/\\"><s:Body xmlns:xsi=\\"http://www.w3.org/2001/XMLSchema-instance\\" xmlns:xsd=\\"http://www.w3.org/2001/XMLSchema\\"><SubmitExResponse xmlns=\\"http://tempuri.org/\\"><SubmitExResult><routing xmlns=\\"BizTalkMessage\\"><org orgID=\\"4\\" orgCode=\\"ICCU\\"/><action transactionType=\\"API\\"/><user userName=\\"ICCUImportUser\\"/><interface interfaceID=\\"600001\\"/><system/><approResult><result>Success</result></approResult></routing><body xmlns=\\"BizTalkMessage\\"><actionAPI version=\\"1\\" xmlns=\\"\\"><createApp><msg:appImportResponse msg:approVersion=\\"4.1\\" xmlns:msg=\\"Messages\\" xmlns:app=\\"App\\" xmlns:maint=\\"Maint\\" xmlns:util=\\"Util\\" xmlns:common=\\"Common\\"><msg:approResult><common:result>Success</common:result></msg:approResult><msg:appIDs><msg:appID>301001062</msg:appID></msg:appIDs><msg:applications><app:files/><app:application app:applicationID=\\"301001062\\" app:appNum=\\"301001062\\" app:appReceivedDate=\\"2019-12-13T10:34:06.486\\" app:appInitiatedDate=\\"2019-12-13T10:34:06.486\\" app:priorityCD=\\"High\\" app:deliveryMethodCD=\\"Internet\\" app:applicantStructureTypeCD=\\"Joint\\" app:referenceNumber=\\"AVOKA-DEV-becdfca2-11ff-428e-815e-121979ed7a13\\"><app:appParties><app:primaryBorrower common:idRef=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyType=\\"Individual\\"><app:appPartyResources><app:appPartyResource app:resourceID=\\"98\\"/></app:appPartyResources></app:primaryBorrower><app:borrower common:idRef=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyType=\\"Individual\\"><app:appPartyResources><app:appPartyResource app:resourceID=\\"98\\"/></app:appPartyResources></app:borrower><app:sourceChannel common:idRef=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:partyType=\\"Channel\\" app:appPartyType=\\"SourceChannel\\"/><app:servicingChannel common:idRef=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:partyType=\\"Channel\\" app:appPartyType=\\"ServicingChannel\\"/></app:appParties><app:parties><common:group common:id=\\"63836382-4c45-4313-afc7-a3750b1730e3\\" common:isNew=\\"false\\" common:partyID=\\"11878\\"><common:partyTypes><common:partyType>Team</common:partyType></common:partyTypes></common:group><common:employer common:id=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\" common:partyID=\\"2400330\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.4\\" common:name=\\"Test\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791968\\" common:contactMechanismType=\\"WorkPhone\\" common:contactString=\\"3081231234\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism></common:contactMechanisms></common:employer><common:channel common:id=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:isNew=\\"false\\" common:partyID=\\"12009\\"/><common:individual common:id=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyID=\\"2400328\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.247\\" common:ssn=\\"559595371\\" common:firstName=\\"Brianna\\" common:lastName=\\"Ridgway\\" common:dob=\\"1979-02-05\\" common:age=\\"40\\" common:mothersMaidenName=\\"null\\" common:isPermanentResidentFL=\\"false\\" common:hasAlienRegNumFL=\\"false\\" common:numOfDependants=\\"0\\" common:isExistingCustomerFL=\\"false\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791960\\" common:contactMechanismType=\\"CurrentAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791961\\" common:contactMechanismType=\\"MailingAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791962\\" common:contactMechanismType=\\"HomePhone\\" common:contactString=\\"3081212332\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791963\\" common:contactMechanismType=\\"EMail\\" common:contactString=\\"bridgway@iccu.com\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\"/></common:contactMechanism></common:contactMechanisms><common:partyRelationships><common:employment common:relationshipType=\\"Employment\\"><common:partyRef common:isNew=\\"true\\" common:idRef=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\" common:partyType=\\"Employer\\"/><common:employmentSubRel common:isNew=\\"false\\" common:isCurrentFL=\\"true\\" common:title=\\"Testinger\\" common:monthsEmployed=\\"47\\" common:employmentType=\\"FullTime\\"><common:userEmploymentType common:isNew=\\"false\\" common:CD=\\"2\\"/></common:employmentSubRel></common:employment></common:partyRelationships><common:partyIdentifications><common:partyIdentification common:IDNum=\\"180011210\\" common:dateOfIssuance=\\"2012-01-01T00:00:00\\" common:issuanceEntity=\\"CO\\" common:expirationDate=\\"2025-01-01T00:00:00\\" common:partyIdentificationID=\\"1540\\"><common:identificationCD common:isNew=\\"false\\" common:lookupType=\\"IdentificationType\\" common:CD=\\"D\\" common:name=\\"Drivers_License\\" common:isActive=\\"true\\"/></common:partyIdentification></common:partyIdentifications><common:incomes><common:income common:incomeID=\\"3725\\" common:IncomeTypeCD=\\"Salary\\" common:frequency=\\"Annually\\" common:amountPerPeriod=\\"50000.0\\" common:hoursPerWeek=\\"40\\" common:incomeStatus=\\"IncomeStatus_Included\\" common:incomeAdjustmentPercentage=\\"1\\"><common:employerRef common:isNew=\\"true\\" common:idRef=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\"/></common:income></common:incomes><common:trades><common:trade common:tradeID=\\"46399\\" common:accountTypeCD=\\"RealEstateMortgage\\" common:tradeTypeID=\\"Mortgage\\" common:creditorName=\\"\\" common:debtStatusCD=\\"Include\\" common:ecoaCD=\\"Individual\\" common:monthlyPayment=\\"500.0\\" common:isCurrResidenceRentMortgage=\\"true\\" common:isSecured=\\"true\\"><common:kindOfBusiness common:isNew=\\"false\\" common:lookupType=\\"KOB\\" common:CD=\\"FM\\"/></common:trade></common:trades></common:individual><common:user common:id=\\"801f914d-b637-41b3-af83-d9be2f8bb793\\" common:isNew=\\"false\\" common:partyID=\\"1493309\\" common:beginDate=\\"2018-08-09T09:28:40.737\\" common:timeZoneCode=\\"MST\\"><common:partyTypes><common:partyType>User</common:partyType><common:partyType>LoanOfficer</common:partyType></common:partyTypes></common:user><common:channel common:id=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:isNew=\\"false\\" common:partyID=\\"12009\\"/><common:organization common:id=\\"6b1fc6f4-5385-4669-8e8f-19041cc91924\\" common:isNew=\\"false\\" common:partyID=\\"4\\" common:name=\\"Idaho Central CU\\" common:description=\\"LoanCenter\\"><common:partyRelationships><common:partyRelationship common:relationshipType=\\"OrganizationToCustomerDataOwnership\\"><common:partyRef common:isNew=\\"false\\" common:idRef=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyType=\\"Individual\\"/></common:partyRelationship><common:partyRelationship common:relationshipType=\\"OrganizationToCustomerDataOwnership\\"><common:partyRef common:isNew=\\"false\\" common:idRef=\\"5e8c4ce4-156a-4d5d-9b18-6c3e1d9b40f9\\" common:partyType=\\"Individual\\"/></common:partyRelationship></common:partyRelationships></common:organization><common:employer common:id=\\"3b1fe5bd-3418-4fbd-9739-db26fec86998\\" common:partyID=\\"2400331\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.4\\" common:name=\\"Testing\\"><common:contactMechanisms/></common:employer><common:individual common:id=\\"3ddae413-7b68-408e-9106-6b3f5b6cbc3d\\" common:partyID=\\"2400329\\" common:languageID=\\"English\\" common:beginDate=\\"2019-12-13T17:34:12.247\\" common:ssn=\\"666371340\\" common:firstName=\\"Paul\\" common:lastName=\\"Ferguson\\" common:dob=\\"1958-01-01\\" common:age=\\"61\\" common:mothersMaidenName=\\"null\\" common:isPermanentResidentFL=\\"false\\" common:hasAlienRegNumFL=\\"false\\" common:numOfDependants=\\"0\\" common:isExistingCustomerFL=\\"false\\"><common:contactMechanisms><common:contactMechanism common:contactMechanismID=\\"6791964\\" common:contactMechanismType=\\"CurrentAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791965\\" common:contactMechanismType=\\"MailingAddress\\" common:isPreferredContactMechanismFL=\\"false\\"><common:addressRef common:isNew=\\"false\\" common:idRef=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\"/><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"2\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791966\\" common:contactMechanismType=\\"HomePhone\\" common:contactString=\\"7733504879\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\" common:CD=\\"1\\"/></common:contactMechanism><common:contactMechanism common:contactMechanismID=\\"6791967\\" common:contactMechanismType=\\"EMail\\" common:contactString=\\"dmagill@gmail.com\\" common:isPreferredContactMechanismFL=\\"false\\"><common:contactMechanismCategory common:isNew=\\"false\\"/></common:contactMechanism></common:contactMechanisms><common:partyRelationships><common:employment common:relationshipType=\\"Employment\\"><common:partyRef common:isNew=\\"true\\" common:idRef=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\" common:partyType=\\"Employer\\"/><common:employmentSubRel common:isNew=\\"false\\" common:isCurrentFL=\\"true\\" common:title=\\"Tester\\" common:monthsEmployed=\\"95\\" common:employmentType=\\"FullTime\\"><common:userEmploymentType common:isNew=\\"false\\" common:CD=\\"2\\"/></common:employmentSubRel></common:employment></common:partyRelationships><common:partyIdentifications><common:partyIdentification common:IDNum=\\"123456789\\" common:dateOfIssuance=\\"1990-01-01T00:00:00\\" common:issuanceEntity=\\"CO\\" common:expirationDate=\\"2020-01-01T00:00:00\\" common:partyIdentificationID=\\"1541\\"><common:identificationCD common:isNew=\\"false\\" common:lookupType=\\"IdentificationType\\" common:CD=\\"D\\" common:name=\\"Drivers_License\\" common:isActive=\\"true\\"/></common:partyIdentification></common:partyIdentifications><common:incomes><common:income common:incomeID=\\"3726\\" common:IncomeTypeCD=\\"Salary\\" common:frequency=\\"Annually\\" common:amountPerPeriod=\\"75000.0\\" common:hoursPerWeek=\\"40\\" common:incomeStatus=\\"IncomeStatus_Included\\" common:incomeAdjustmentPercentage=\\"1\\"><common:employerRef common:isNew=\\"true\\" common:idRef=\\"8be086e9-de82-4849-8a77-7a3d077cff3c\\"/></common:income></common:incomes><common:trades><common:trade common:tradeID=\\"46400\\" common:accountTypeCD=\\"RealEstateMortgage\\" common:tradeTypeID=\\"Mortgage\\" common:creditorName=\\"\\" common:debtStatusCD=\\"Include\\" common:ecoaCD=\\"Individual\\" common:monthlyPayment=\\"400.0\\" common:isCurrResidenceRentMortgage=\\"true\\" common:isSecured=\\"true\\"><common:kindOfBusiness common:isNew=\\"false\\" common:lookupType=\\"KOB\\" common:CD=\\"FM\\"/></common:trade></common:trades></common:individual></app:parties><app:appDetails><app:appDetailLOC app:appDetailID=\\"4276\\" app:appDetailSavePoint=\\"Current\\" app:contractDate=\\"2019-12-13T17:34:09.1016107\\" app:contractRate=\\"0.0200\\" app:financedAmt=\\"2500.0\\" app:equityPercentage=\\"0\\" app:termInMonths=\\"12\\" app:termFrequencyCD=\\"Monthly\\" app:daysPerYear=\\"360\\" app:calculationType=\\"OpenEnd\\" app:loanType=\\"Consumer\\" app:interestRateType=\\"Fixed\\" app:rankNum=\\"1\\" app:maxContractRate=\\"0.1799\\" app:minContractRate=\\"0.1799\\" app:baseRate=\\"0.18000000\\" app:insuranceOptionID=\\"1\\" app:paymentCalculationType=\\"PctOfAmountRequested\\" app:requestedAmtPaymentPct=\\"0.020\\"><app:appDetailParties><app:appDetailParty common:idRef=\\"b8c9d648-3fb7-48f6-988e-ce6b5332f448\\" common:partyType=\\"Channel\\" app:appPartyType=\\"SourceChannel\\"/><app:appDetailParty common:idRef=\\"5f798809-1215-40a7-bed6-52fc700c4bfc\\" common:partyType=\\"Channel\\" app:appPartyType=\\"ServicingChannel\\"/><app:appDetailParty common:idRef=\\"801f914d-b637-41b3-af83-d9be2f8bb793\\" common:partyType=\\"User\\" app:appPartyType=\\"LoanOfficer\\"/><app:appDetailParty common:idRef=\\"63836382-4c45-4313-afc7-a3750b1730e3\\" app:appPartyType=\\"QueuedFromUser\\"/></app:appDetailParties><app:appDetailRequestedAmts><app:appDetailRequestedAmt app:appDetailRequestedAmtID=\\"69526\\" app:requestedAmount=\\"2500.0\\" app:requestedAmountType=\\"Generic\\"/></app:appDetailRequestedAmts><app:appDetailStatuses><app:appDetailStatus app:appDetailStatusID=\\"14396\\" app:statusType=\\"WorkflowStatus\\" app:status=\\"WorkflowStatus_DataAcquisition\\"/></app:appDetailStatuses><app:product common:isNew=\\"false\\" common:productID=\\"117\\" common:beginDate=\\"2014-12-10T00:00:00\\" common:shortName=\\"PLOC\\" common:name=\\"Personal Line of Credit\\" common:isActiveFL=\\"true\\" common:productTypeID=\\"LOC\\" common:loanType=\\"Consumer\\" common:liquidCreditProductCategoryCD=\\"2100\\" common:orgID=\\"4\\"><common:organizationRef common:isNew=\\"false\\" common:idRef=\\"bcac6b22-19ff-4330-910b-429ebc0d2717\\"/><common:productCategory common:isNew=\\"false\\" common:productCategoryID=\\"22\\" common:name=\\"Direct Products\\" common:description=\\"Direct Products\\" common:isActiveFL=\\"true\\"><common:organizationRef common:isNew=\\"false\\" common:idRef=\\"bcac6b22-19ff-4330-910b-429ebc0d2717\\"/></common:productCategory><common:initialTeamRef common:isNew=\\"false\\" common:idRef=\\"d85edbc0-b4f9-41a8-bf96-a9b4d0013f76\\"/><common:productFormPackage common:isNew=\\"false\\" common:CD=\\"2\\" common:name=\\"LOC / HELOC\\" common:formPackageTypeID=\\"1\\"/></app:product><app:appDetailStipulations><app:appDetailStipulation app:appDetailStipulationID=\\"37904\\" app:status=\\"Open\\" app:name=\\"Duplicate Fraud Alerts:  Select satisfied if a trigger happened and it was addressed in notes.  Select waived if an alert did not trigger.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"16\\" common:name=\\"Duplicate Fraud Alerts:  Select satisfied if a trigger happened and it was addressed in notes.  Select waived if an alert did not trigger.\\" common:sortOrder=\\"0\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37905\\" app:status=\\"Open\\" app:name=\\"Employment Income Verification:  Select satisfied if verification was obtained and/or documented or imaged.  Select waived if the loan meets guidelines to waive verification.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"17\\" common:name=\\"Employment Income Verification:  Select satisfied if verification was obtained and/or documented or imaged.  Select waived if the loan meets guidelines to waive verification.\\" common:sortOrder=\\"1\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37906\\" app:status=\\"Open\\" app:name=\\"Loan Aggregates:  Select satisfied if the loan needs to go to Loan Committee for approval due to aggregates.  Select waived if the loan does not need to go to Loan Committee due to aggregates.\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"18\\" common:name=\\"Loan Aggregates:  Select satisfied if the loan needs to go to Loan Committee for approval due to aggregates.  Select waived if the loan does not need to go to Loan Committee due to aggregates.\\" common:sortOrder=\\"2\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation><app:appDetailStipulation app:appDetailStipulationID=\\"37907\\" app:status=\\"Open\\" app:name=\\"Verify Primary Borrower is Tax Owner on Share\\"><app:stipulation common:isNew=\\"false\\" common:stipulationID=\\"77\\" common:name=\\"Verify Primary Borrower is Tax Owner on Share\\" common:sortOrder=\\"3\\"/><app:stipulationSource common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailStipulation></app:appDetailStipulations><app:riskProcessingLevel common:isNew=\\"false\\" common:lookupType=\\"RPL\\" common:CD=\\"1\\"/><app:fields><common:lookupFieldLink common:value=\\"210\\"><common:customLookupField common:isNew=\\"false\\" common:name=\\"Does primary applicant have a valid email address?\\" common:ID=\\"-127\\" common:fieldLevel=\\"ProductCategory\\"/></common:lookupFieldLink></app:fields><app:pricingPlan common:isNew=\\"false\\" common:planID=\\"14\\"/><app:appDetailIndirect common:isNew=\\"false\\" app:payDealerNow=\\"false\\" app:payOriginationFeeNow=\\"false\\" app:calcOriginationFeeFL=\\"false\\" app:useCRBRRuleFL=\\"false\\" app:isOriginationFeeValuePct=\\"false\\" app:calcDiscountFL=\\"false\\" app:globalDiscountFL=\\"true\\" app:federalDisclosureFL=\\"false\\"/><app:loanPurposes><app:appDetailLoanPurpose app:rank=\\"1\\"><app:loanPurpose common:isNew=\\"false\\" common:CD=\\"137\\"/></app:appDetailLoanPurpose></app:loanPurposes><app:contractRateIndex common:isNew=\\"true\\" common:rateIndexID=\\"4\\"/><app:appDetailProcessQuestionResponses><app:appDetailQuestionResponse app:appDetailQuestionResponseID=\\"12533\\" app:processID=\\"51\\" app:ordernum=\\"0\\"><app:question common:isNew=\\"false\\" common:questionID=\\"86\\"/><app:lookupResponse common:isNew=\\"false\\" common:CD=\\"2\\"/></app:appDetailQuestionResponse></app:appDetailProcessQuestionResponses></app:appDetailLOC></app:appDetails><app:properties/><app:addresses><common:address common:id=\\"9f4c020e-adba-46cd-88d3-989ad59abdca\\" common:addressID=\\"3188091\\" common:street1=\\"4400 Central Way\\" common:street2=\\"\\" common:postalCode=\\"83202\\" common:cityName=\\"Chubbuck\\" common:monthsResided=\\"95\\" common:state=\\"ID\\" common:country=\\"UnitedStates\\"><common:residenceType common:isNew=\\"false\\" common:CD=\\"Rent\\"/></common:address><common:address common:id=\\"4d56834d-bd6e-46de-a6b8-a3fd2e3cff46\\" common:addressID=\\"3188092\\" common:street1=\\"4400 Central Way\\" common:street2=\\"\\" common:postalCode=\\"83202\\" common:cityName=\\"Chubbuck\\" common:monthsResided=\\"59\\" common:state=\\"ID\\" common:country=\\"UnitedStates\\"><common:residenceType common:isNew=\\"false\\" common:CD=\\"Rent\\"/></common:address></app:addresses><app:scores/><app:org common:isNew=\\"false\\" common:idRef=\\"6b1fc6f4-5385-4669-8e8f-19041cc91924\\"/><app:appServiceRequests/><app:vehicleValuations/><app:deliverySource common:isNew=\\"false\\" common:CD=\\"600001\\"/><app:serviceRequestGroups/></app:application></msg:applications></msg:appImportResponse></createApp></actionAPI></body></SubmitExResult></SubmitExResponse></s:Body></s:Envelope>","user_action":"","tracking_number":"XW3WXBZ"},{"system_name":"CrifDecisioning","system_display_name":"CRIF - Decisioning","status":"success","decision":"APPROVE","everything":"<s:Envelope xmlns:s=\\"http://schemas.xmlsoap.org/soap/envelope/\\"><s:Body xmlns:xsi=\\"http://www.w3.org/2001/XMLSchema-instance\\" xmlns:xsd=\\"http://www.w3.org/2001/XMLSchema\\"><SubmitExResponse xmlns=\\"http://tempuri.org/\\"><SubmitExResult><routing xmlns=\\"BizTalkMessage\\"><org orgID=\\"4\\" orgCode=\\"ICCU\\"/><action transactionType=\\"API\\"/><user userName=\\"ICCUImportUser\\"/><interface interfaceID=\\"600001\\"/><system/><approResult><result>Success</result></approResult></routing><body xmlns=\\"BizTalkMessage\\"><actionAPI version=\\"1\\" xmlns=\\"\\"><sendToDecisioning><errors><error>System.ApplicationException:EXCEPTION TEXT: System.InvalidCastException: Specified cast is not valid.</error></errors></sendToDecisioning></actionAPI></body></SubmitExResult></SubmitExResponse></s:Body></s:Envelope>","user_action":"","tracking_number":"XW3WXBZ"}]},"coApplicants":[{"person":{"first_name":"Brianna","last_name":"Ridgway","birth_date":"1979-02-05","primary_address":{"line_1":null,"line_2":null,"city":null,"state":null,"country":"USA","postal_code":null},"identification":{"type":"DriversLicense","id_number":"180011210","issuing_authority":"CO","issue_date":"2012-01-01","expire_date":"2025-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"3081212332","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"bridgway@iccu.com"},"persona":null}],"products":[{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}],"fundingInfo":{"from_account_uuid":null,"payment_type":null,"is_using_external_processor":null,"opened_accounts":[{"account":{"unique_id":"0fe157d2-3000-4341-b955-370e5bab8a49","account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":null,"funding_source":null}]},"reports":[],"app_status":"complete","version":"3","external_crm_id":null,"promotions":[],"form":{"name":"Disclosures and Signatures","tracking_code":"9F6WQG2","job_reference_code":"S4ZS5FM","url":"https://dev.iccu.avoka-transact.com/apps/secure/form.htm?submitKey=200e62d7f7d827b714e719a21190c4e8"}}';
        AOApplicationRestRequest request = AOApplicationRestRequest.parse(testData);
        AOApplicationInfo appInfo = new AOApplicationInfo(request);

        Test.startTest();

        AOCRIFDecisionLogParser parser = new AOCRIFDecisionLogParser();
        try {
            parser.parsePayload(request.applicant.system_info, appInfo);
        } catch(Exception e) {
            System.assert(false, 'Threw an exception: ' + e + ' stack trace: ' + e.getStackTraceString());
        }

        Test.stopTest();

        String systemName = parser.getSystemName();
        AOInteractionResult result = appInfo.systemInteractionResults.get(systemName);

        System.assertNotEquals(null, result);
        System.assertEquals(AOInteractionResult.State.SUCCESS, result.state);
        System.assertEquals(null, appInfo.loanApplicationIds);
        System.assertNotEquals(null, appInfo.loanErrors);
        System.assertEquals(1, appInfo.loanErrors.size());
    }

    @IsTest
    private static void testInvalidXml() {
        String testData = '{"applicant":{"person":{"first_name":"Paul","last_name":"Ferguson","birth_date":"1958-01-01","tax_id":"666-37-1340","primary_address":{"line_1":"4400 Central Way","line_2":null,"city":"Chubbuck","state":"ID","country":"USA","postal_code":"83202"},"identification":{"type":"DriversLicense","id_number":"123456789","issuing_authority":"CO","issue_date":"1990-01-01","expire_date":"2020-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"7733504879","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"dmagill@gmail.com"},"persona":"Unknown","membership_eligibility":null,"system_info":[{"system_name":"CrifDecisioning","system_display_name":"CRIF - Decisioning","status":"success","decision":"APPROVE","everything":"s:Envelope xmlns:s=\\"http://schemas.xmlsoap.org/soap/envelope/\\"><s:Body xmlns:xsi=\\"http://www.w3.org/2001/XMLSchema-instance\\" xmlns:xsd=\\"http://www.w3.org/2001/XMLSchema\\"><SubmitExResponse xmlns=\\"http://tempuri.org/\\"><SubmitExResult><routing xmlns=\\"BizTalkMessage\\"><org orgID=\\"4\\" orgCode=\\"ICCU\\"/><action transactionType=\\"API\\"/><user userName=\\"ICCUImportUser\\"/><interface interfaceID=\\"600001\\"/><system/><approResult><result>Success</result></approResult></routing><body xmlns=\\"BizTalkMessage\\"><actionAPI version=\\"1\\" xmlns=\\"\\"><sendToDecisioning><errors><error>System.ApplicationException:EXCEPTION TEXT: System.InvalidCastException: Specified cast is not valid.</error></errors></sendToDecisioning></actionAPI></body></SubmitExResult></SubmitExResponse></s:Body></s:Envelope>","user_action":"","tracking_number":"XW3WXBZ"}]},"coApplicants":[{"person":{"first_name":"Brianna","last_name":"Ridgway","birth_date":"1979-02-05","primary_address":{"line_1":null,"line_2":null,"city":null,"state":null,"country":"USA","postal_code":null},"identification":{"type":"DriversLicense","id_number":"180011210","issuing_authority":"CO","issue_date":"2012-01-01","expire_date":"2025-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"3081212332","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"bridgway@iccu.com"},"persona":null}],"products":[{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}],"fundingInfo":{"from_account_uuid":null,"payment_type":null,"is_using_external_processor":null,"opened_accounts":[{"account":{"unique_id":"0fe157d2-3000-4341-b955-370e5bab8a49","account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":"Personal Line of Credit","major_type":"CRIF","minor_type":"117"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":null,"funding_source":null}]},"reports":[],"app_status":"complete","version":"3","external_crm_id":null,"promotions":[],"form":{"name":"Disclosures and Signatures","tracking_code":"9F6WQG2","job_reference_code":"S4ZS5FM","url":"https://dev.iccu.avoka-transact.com/apps/secure/form.htm?submitKey=200e62d7f7d827b714e719a21190c4e8"}}';
        AOApplicationRestRequest request = AOApplicationRestRequest.parse(testData);
        AOApplicationInfo appInfo = new AOApplicationInfo(request);

        Test.startTest();

        AOCRIFDecisionLogParser parser = new AOCRIFDecisionLogParser();
        try {
            parser.parsePayload(request.applicant.system_info, appInfo);
        } catch(Exception e) {
            System.assert(false, 'Threw an exception: ' + e + ' stack trace: ' + e.getStackTraceString());
        }

        Test.stopTest();

        String systemName = parser.getSystemName();
        AOInteractionResult result = appInfo.systemInteractionResults.get(systemName);

        System.assertNotEquals(null, result);
        System.assertEquals(AOInteractionResult.State.ERROR, result.state);
        System.assertEquals(null, appInfo.loanApplicationIds);
        System.assertEquals(0, appInfo.errors.size());
        System.assertEquals(null, appInfo.loanErrors);
    }

}