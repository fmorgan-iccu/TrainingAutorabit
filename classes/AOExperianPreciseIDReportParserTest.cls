@IsTest
private class AOExperianPreciseIDReportParserTest {

    @IsTest
    private static void testHappyPath() {
        String testData = '{"form":{"name":"accountsandfunding","tracking_code":"HGXQRZ7","job_reference_code":"PV4DHML"},"applicant":{"person":{"first_name":"Paul","last_name":"Ferguson","birth_date":"1958-01-01","tax_id":"666-37-1340","primary_address":{"line_1":"4400 Central Way","line_2":"Ste 510","city":"Chubbuck","state":"ID","country":"USA","postal_code":"83202"},"identification":{"type":"drivers_license","id_number":"101800775","issuing_authority":"CO","issue_date":"2018-01-01","expire_date":"2028-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"3081231234","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"dmagill@iccu.com"},"persona":"Unknown","membership_eligibility":"I\'m not a permanent resident, but am an employee, employer, student and/or retiree working in Idaho.","system_info":[{"system_name":"ExperianValidateKBAAnswers","system_display_name":"Experian Validate KBA Answers","status":"200","decision":"APPROVED","everything":"{\\"responseHeader\\":{\\"requestType\\":\\"PreciseIdOnly\\",\\"clientReferenceId\\":\\"HGXQRZ720191210023850\\",\\"expRequestId\\":\\"RB000081299918\\",\\"messageTime\\":\\"2019-12-10T14:38:50Z\\",\\"overallResponse\\":{\\"decision\\":\\"ACCEPT\\",\\"decisionText\\":\\"Continue\\",\\"decisionReasons\\":[\\"PreciseId - Accept\\"],\\"recommendedNextActions\\":[],\\"spareObjects\\":[]},\\"responseCode\\":\\"R0201\\",\\"responseType\\":\\"INFO\\",\\"responseMessage\\":\\"Workflow Complete.\\",\\"tenantID\\":\\"Y36ZJBSA\\"},\\"clientResponsePayload\\":{\\"orchestrationDecisions\\":[{\\"sequenceId\\":\\"1\\",\\"decisionSource\\":\\"PreciseID\\",\\"decision\\":\\"ACCEPT\\",\\"decisionReasons\\":[\\"PreciseId - Accept\\"],\\"score\\":516,\\"decisionText\\":\\"Continue\\",\\"nextAction\\":\\"Continue\\",\\"appReference\\":\\"72894720\\",\\"decisionTime\\":\\"2019-12-10T21:38:51Z\\"}],\\"decisionElements\\":[{\\"serviceName\\":\\"PreciseId\\",\\"decision\\":\\"ACC\\",\\"score\\":516,\\"decisionText\\":\\"Accept\\",\\"appReference\\":\\"72894720\\",\\"rules\\":[{\\"ruleId\\":\\"3401\\",\\"ruleName\\":\\"glbRule01\\"},{\\"ruleId\\":\\"1003\\",\\"ruleName\\":\\"glbRule02\\"},{\\"ruleId\\":\\"3203\\",\\"ruleName\\":\\"glbRule03\\"},{\\"ruleId\\":\\"1008\\",\\"ruleName\\":\\"glbRule04\\"},{\\"ruleId\\":\\"3204\\",\\"ruleName\\":\\"glbRule05\\"},{\\"ruleId\\":\\"3201\\",\\"ruleName\\":\\"glbRule06\\"},{\\"ruleId\\":\\"3405\\",\\"ruleName\\":\\"glbRule07\\"}],\\"otherData\\":{\\"json\\":{\\"fraudSolutions\\":{\\"response\\":{\\"products\\":{\\"preciseIDServer\\":{\\"sessionID\\":\\"7XVCQTTMHTZW13NZFP2ZSFMS.pidd1v-191210153839711407154\\",\\"header\\":{\\"reportDate\\":\\"12102019\\",\\"reportTime\\":\\"153835\\",\\"productOption\\":\\"11\\",\\"subcode\\":\\"2851150\\",\\"referenceNumber\\":\\"HGXQRZ720191210023837\\"},\\"messages\\":{\\"message\\":[{\\"number\\":\\"57\\",\\"text\\":\\"015000    0500\\",\\"addrMismatch\\":\\"Y\\"}],\\"consumerStatement\\":[]},\\"summary\\":{\\"transactionID\\":\\"72894720\\",\\"initialDecision\\":\\"R10\\",\\"finalDecision\\":\\"ACC\\",\\"scores\\":{\\"preciseIDScore\\":\\"516\\",\\"preciseIDScorecard\\":\\"AC OPEN V2\\",\\"validationScore\\":\\"000477\\",\\"validationScorecard\\":\\"AC OPEN VAL V2\\",\\"verificationScore\\":\\"000427\\",\\"verificationScorecard\\":\\"AC OPEN ID THEFT V2\\",\\"complianceDescription\\":\\"No Compliance Code\\",\\"reasons\\":{\\"reason\\":[{\\"value\\":\\"\\",\\"code\\":\\"B101\\"},{\\"value\\":\\"\\",\\"code\\":\\"B109\\"},{\\"value\\":\\"\\",\\"code\\":\\"B110\\"},{\\"value\\":\\"\\",\\"code\\":\\"B108\\"},{\\"value\\":\\"\\",\\"code\\":\\"B405\\"}]},\\"fpdscore\\":\\"000684\\",\\"fpdscorecard\\":\\"AC OPEN FPD V2\\"}},\\"preciseMatch\\":{\\"version\\":\\"02.00\\",\\"responseStatusCode\\":{\\"value\\":\\"\\",\\"code\\":\\"00\\"},\\"preciseMatchTransactionID\\":\\"beb3f061-c446-45f8-8\\",\\"preciseMatchScore\\":\\"488\\",\\"preciseMatchDecision\\":{\\"value\\":\\"\\",\\"code\\":\\" \\"},\\"addresses\\":{\\"address\\":[{\\"summary\\":{\\"verificationResult\\":{\\"value\\":\\"\\",\\"code\\":\\"X0\\"},\\"type\\":{\\"value\\":\\"\\",\\"code\\":\\"N \\"},\\"unitMismatchResult\\":{\\"value\\":\\"\\",\\"code\\":\\"  \\"},\\"highRiskResult\\":{\\"value\\":\\"\\",\\"code\\":\\"N \\"},\\"counts\\":{\\"standardizedAddressReturnCount\\":1,\\"residentialAddressMatchCount\\":0,\\"residentialAddressReturnCount\\":0,\\"highRiskAddressReturnCount\\":0,\\"businessAddressMatchCount\\":0,\\"businessAddressReturnCount\\":0}},\\"detail\\":{\\"standardizedAddressRcd\\":{\\"surname\\":\\"FERGUSON\\",\\"firstName\\":\\"PAUL\\",\\"address\\":\\"4400 CENTRAL WAY STE 510\\",\\"city\\":\\"CHUBBUCK\\",\\"state\\":\\"ID\\",\\"zipCode\\":\\"83202\\"},\\"residentialAddressRcd\\":[],\\"highRiskAddressRcd\\":[],\\"highRiskAddressDescription\\":[{\\"highRiskDescription\\":\\"No high risk business at address/phone\\"}],\\"businessAddressRcd\\":[]}}]},\\"phones\\":{\\"phone\\":[{\\"summary\\":{\\"verificationResult\\":{\\"value\\":\\"\\",\\"code\\":\\"NX\\"},\\"classification\\":{\\"value\\":\\"\\",\\"code\\":\\"X\\"},\\"highRiskResult\\":{\\"value\\":\\"\\",\\"code\\":\\"N\\"},\\"counts\\":{\\"residentialPhoneMatchCount\\":0,\\"residentialPhoneReturnCount\\":0,\\"highRiskPhoneReturnCount\\":0,\\"businessPhoneMatchCount\\":0,\\"businessPhoneReturnCount\\":0}},\\"detail\\":{\\"residentialPhoneRcd\\":[],\\"phoneHighRiskRcd\\":[],\\"highRiskPhoneDescription\\":[{\\"highRiskDescription\\":\\"No high risk business at address/phone\\"}],\\"businessPhoneRcd\\":[]}}]},\\"consumerID\\":{\\"summary\\":{\\"verificationResult\\":{\\"value\\":\\"\\",\\"code\\":\\"Y \\"},\\"deceasedResult\\":{\\"value\\":\\"\\",\\"code\\":\\"N\\"},\\"formatResult\\":{\\"value\\":\\"\\",\\"code\\":\\"V\\"},\\"issueResult\\":{\\"value\\":\\"\\",\\"code\\":\\"C\\"},\\"counts\\":{\\"consumerIDReturnCount\\":2}},\\"detail\\":{\\"consumerIDRcd\\":[{\\"surname\\":\\"FERGUSON\\",\\"firstName\\":\\"PAUL\\",\\"aliasName\\":[],\\"address\\":\\"PO BOX 94\\",\\"city\\":\\"MARTIN\\",\\"state\\":\\"TN\\",\\"zipCode\\":\\"38237\\",\\"zipPlus4\\":\\"0094\\",\\"reportedDate\\":\\"20060517\\",\\"lastUpdatedDate\\":\\"20060717\\"},{\\"surname\\":\\"BERRY\\",\\"firstName\\":\\"STEVEN\\",\\"middle\\":\\"J\\",\\"aliasName\\":[],\\"address\\":\\"1510 EUBANKS RD\\",\\"city\\":\\"CALHOUN\\",\\"state\\":\\"KY\\",\\"zipCode\\":\\"42327\\",\\"zipPlus4\\":\\"9776\\",\\"areaCode\\":\\"270\\",\\"phone\\":\\"7336625\\",\\"reportedDate\\":\\"20040926\\",\\"lastUpdatedDate\\":\\"20060513\\"}]}},\\"dateOfBirth\\":{\\"summary\\":{\\"matchResult\\":{\\"value\\":\\"\\",\\"code\\":\\"8\\"},\\"yearOfBirth\\":\\"1958\\"}},\\"driverLicense\\":{\\"summary\\":{\\"verificationResult\\":{\\"value\\":\\"\\",\\"code\\":\\"NA\\"},\\"formatValidation\\":{\\"value\\":\\"\\",\\"code\\":\\"V\\"}}},\\"changeOfAddresses\\":{\\"changeOfAddress\\":[{\\"summary\\":{\\"verificationResult\\":{\\"value\\":\\"\\",\\"code\\":\\"N \\"},\\"counts\\":{\\"changeOfAddressReturnCount\\":0}}}]},\\"ofac\\":{\\"summary\\":{\\"verificationResult\\":{\\"value\\":\\"\\",\\"code\\":\\"1 \\"},\\"counts\\":{\\"ofacReturnCount\\":0}}},\\"previousAddresses\\":{\\"previousAddress\\":[{\\"summary\\":{\\"counts\\":{\\"previousAddressReturnCount\\":2}},\\"detail\\":{\\"previousAddressRcd\\":[{\\"address\\":\\"1848 DEER PARK AVE\\",\\"city\\":\\"DEER PARK\\",\\"state\\":\\"NY\\",\\"zipCode\\":\\"11729\\",\\"zipPlus4\\":\\"4318\\",\\"reportedDate\\":\\"20020406\\",\\"lastUpdatedDate\\":\\"20060627\\"},{\\"address\\":\\"343 ADAMS AVE\\",\\"city\\":\\"DES MOINES\\",\\"state\\":\\"IA\\",\\"reportedDate\\":\\"20060610\\",\\"lastUpdatedDate\\":\\"20060610\\"}]}}]},\\"ssnfinder\\":{\\"summary\\":{\\"counts\\":{\\"ssnfinderReturnCount\\":0}}}},\\"fcraDetail\\":{\\"fraudShield\\":{\\"indicator\\":[{\\"value\\":\\"N\\",\\"code\\":\\"07\\"},{\\"value\\":\\"N\\",\\"code\\":\\"08\\"},{\\"value\\":\\"N\\",\\"code\\":\\"09\\"},{\\"value\\":\\"N\\",\\"code\\":\\"19\\"},{\\"value\\":\\"N\\",\\"code\\":\\"20\\"},{\\"value\\":\\"N\\",\\"code\\":\\"22\\"},{\\"value\\":\\"N\\",\\"code\\":\\"27\\"}]},\\"adverseActions\\":{\\"adverseAction\\":[{\\"value\\":\\"\\",\\"code\\":\\" \\"},{\\"value\\":\\"\\",\\"code\\":\\" \\"},{\\"value\\":\\"\\",\\"code\\":\\" \\"},{\\"value\\":\\"\\",\\"code\\":\\" \\"}]},\\"fcrarules\\":{\\"fcrarule\\":[{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"}]}},\\"glbDetail\\":{\\"fraudShield\\":{\\"indicator\\":[{\\"value\\":\\"Y\\",\\"code\\":\\"01\\"},{\\"value\\":\\"N\\",\\"code\\":\\"02\\"},{\\"value\\":\\"Y\\",\\"code\\":\\"03\\"},{\\"value\\":\\"N\\",\\"code\\":\\"04\\"},{\\"value\\":\\"N\\",\\"code\\":\\"05\\"},{\\"value\\":\\"Y\\",\\"code\\":\\"06\\"},{\\"value\\":\\"N\\",\\"code\\":\\"10\\"},{\\"value\\":\\"N\\",\\"code\\":\\"11\\"},{\\"value\\":\\"N\\",\\"code\\":\\"13\\"},{\\"value\\":\\"N\\",\\"code\\":\\"14\\"},{\\"value\\":\\"N\\",\\"code\\":\\"15\\"},{\\"value\\":\\"Y\\",\\"code\\":\\"16\\"},{\\"value\\":\\"N\\",\\"code\\":\\"17\\"},{\\"value\\":\\"N\\",\\"code\\":\\"18\\"},{\\"value\\":\\"Y\\",\\"code\\":\\"21\\"},{\\"value\\":\\"N\\",\\"code\\":\\"25\\"},{\\"value\\":\\"N\\",\\"code\\":\\"26\\"}]},\\"glbRules\\":{\\"glbRule\\":[{\\"value\\":\\"\\",\\"code\\":\\"3401\\"},{\\"value\\":\\"\\",\\"code\\":\\"1003\\"},{\\"value\\":\\"\\",\\"code\\":\\"3203\\"},{\\"value\\":\\"\\",\\"code\\":\\"1008\\"},{\\"value\\":\\"\\",\\"code\\":\\"3204\\"},{\\"value\\":\\"\\",\\"code\\":\\"3201\\"},{\\"value\\":\\"\\",\\"code\\":\\"3405\\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"},{\\"value\\":\\"\\",\\"code\\":\\"    \\"}]}},\\"kbascore\\":{\\"general\\":{\\"priorUsage\\":{\\"exceededUseLimitCode\\":\\"N\\",\\"clientUseLimitPeriod\\":0,\\"clientUseLimitCount\\":0,\\"totalUseLimitPeriod\\":0,\\"totalUseLimitCount\\":0,\\"consumerSSNTotal\\":0,\\"clientSSNUseLimitPeriod\\":0,\\"clientSSNUseLimitCount\\":0,\\"totalSSNUseLimitPeriod\\":0,\\"totalSSNUseLimitCount\\":0,\\"concurrentPINTotal\\":0,\\"clientConcurrentPINLimitCount\\":0,\\"companyConcurrentPINLimitCount\\":0,\\"globalConcurrentPINLimitCount\\":0},\\"kbaresultCode\\":0,\\"kbaresultCodeDescription\\":\\"KBA processing successful questions returned\\"},\\"scoreSummary\\":{\\"acceptReferCode\\":\\"ACC\\",\\"decisionOverrideIndicator\\":\\"N\\",\\"preciseIDScore\\":\\"516\\",\\"outWalletScore\\":\\"100\\",\\"outWalletFormula\\":\\"(465/465)*100\\",\\"progressiveQuestionAchieved\\":\\"N\\",\\"championChallengerIndicator\\":\\"N\\",\\"riskStrategyNum\\":\\"1\\",\\"riskStrategyDescription\\":\\"Default Risk Strategy\\",\\"questionConfigNum\\":\\"1\\",\\"questionConfigDescription\\":\\"Default Question Configuration\\",\\"decisionMatrixNum\\":\\"1\\",\\"decisionMatrixDescription\\":\\"Default Decision Matrix\\"},\\"gradedAnswer\\":{\\"answerSet\\":[{\\"questionType\\":25,\\"questionTypeDescription\\":\\"BUSINESS OWNERSHIP ASSOCIATION\\",\\"creditType\\":\\"N\\",\\"answerResult\\":\\"R\\",\\"questionWeight\\":124},{\\"questionType\\":30,\\"questionTypeDescription\\":\\"LICENSE PLATE\\",\\"creditType\\":\\"N\\",\\"answerResult\\":\\"R\\",\\"questionWeight\\":110},{\\"questionType\\":3,\\"questionTypeDescription\\":\\"AUTO LOAN LENDER\\",\\"creditType\\":\\"C\\",\\"answerResult\\":\\"R\\",\\"questionWeight\\":120},{\\"questionType\\":1,\\"questionTypeDescription\\":\\"MORTGAGE LENDER\\",\\"creditType\\":\\"C\\",\\"answerResult\\":\\"R\\",\\"questionWeight\\":111}]}},\\"pidxmlversion\\":\\"06.00\\"}}}}}},\\"decisions\\":[{\\"element\\":\\"messageNumber\\",\\"value\\":\\"57\\",\\"reason\\":\\"015000    0500\\"},{\\"element\\":\\"initialDecision\\",\\"value\\":\\"R10\\"},{\\"element\\":\\"finalDecision\\",\\"value\\":\\"ACC\\"},{\\"element\\":\\"kbaAcceptReferCode\\",\\"value\\":\\"ACC\\"},{\\"element\\":\\"pidScoreReason1\\",\\"value\\":\\"B101\\"},{\\"element\\":\\"pidScoreReason2\\",\\"value\\":\\"B109\\"},{\\"element\\":\\"pidScoreReason3\\",\\"value\\":\\"B110\\"},{\\"element\\":\\"pidScoreReason4\\",\\"value\\":\\"B108\\"},{\\"element\\":\\"pidScoreReason5\\",\\"value\\":\\"B405\\"},{\\"element\\":\\"kbaStatus\\",\\"value\\":\\"N\\"}],\\"matches\\":[{\\"name\\":\\"pmAddressVerificationResult1\\",\\"value\\":\\"X0\\"},{\\"name\\":\\"pmPhoneVerificationResult1\\",\\"value\\":\\"NX\\"},{\\"name\\":\\"pmConsumerIDVerificationResult\\",\\"value\\":\\"Y\\"},{\\"name\\":\\"pmDateOfBirthMatchResult\\",\\"value\\":\\"8\\"},{\\"name\\":\\"pmDriverLicenseVerificationResult\\",\\"value\\":\\"NA\\"},{\\"name\\":\\"pmChangeOfAddressVerificationResult1\\",\\"value\\":\\"N\\"},{\\"name\\":\\"pmOFACVerificationResult\\",\\"value\\":\\"1\\"},{\\"name\\":\\"fcraFSIndicator07\\",\\"value\\":\\"N\\"},{\\"name\\":\\"fcraFSIndicator08\\",\\"value\\":\\"N\\"},{\\"name\\":\\"fcraFSIndicator09\\",\\"value\\":\\"N\\"},{\\"name\\":\\"fcraFSIndicator19\\",\\"value\\":\\"N\\"},{\\"name\\":\\"fcraFSIndicator20\\",\\"value\\":\\"N\\"},{\\"name\\":\\"fcraFSIndicator22\\",\\"value\\":\\"N\\"},{\\"name\\":\\"fcraFSIndicator27\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator01\\",\\"value\\":\\"Y\\"},{\\"name\\":\\"glbFSIndicator02\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator03\\",\\"value\\":\\"Y\\"},{\\"name\\":\\"glbFSIndicator04\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator05\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator06\\",\\"value\\":\\"Y\\"},{\\"name\\":\\"glbFSIndicator10\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator11\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator13\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator14\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator15\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator16\\",\\"value\\":\\"Y\\"},{\\"name\\":\\"glbFSIndicator17\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator18\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator21\\",\\"value\\":\\"Y\\"},{\\"name\\":\\"glbFSIndicator25\\",\\"value\\":\\"N\\"},{\\"name\\":\\"glbFSIndicator26\\",\\"value\\":\\"N\\"}],\\"scores\\":[{\\"name\\":\\"preciseIDScore\\",\\"score\\":516,\\"type\\":\\"score\\"},{\\"name\\":\\"validationScore\\",\\"score\\":477,\\"type\\":\\"score\\"},{\\"name\\":\\"verificationScore\\",\\"score\\":427,\\"type\\":\\"score\\"},{\\"name\\":\\"fpdScore\\",\\"score\\":684,\\"type\\":\\"score\\"},{\\"name\\":\\"preciseMatchScore\\",\\"score\\":488,\\"type\\":\\"score\\"},{\\"name\\":\\"kbaScore\\",\\"score\\":100,\\"type\\":\\"score\\"}]}]},\\"originalRequestData\\":{\\"control\\":[{\\"option\\":\\"PIDXML_VERSION\\",\\"value\\":\\"06.00\\"},{\\"option\\":\\"SUBSCRIBER_PREAMBLE\\",\\"value\\":\\"TRS2\\"},{\\"option\\":\\"SUBSCRIBER_OPERATOR_INITIAL\\",\\"value\\":\\"ID\\"},{\\"option\\":\\"SUBSCRIBER_SUB_CODE\\",\\"value\\":\\"2851150\\"},{\\"option\\":\\"PID_USERNAME\\",\\"value\\":\\"iccu_test\\"},{\\"option\\":\\"PID_PASSWORD\\",\\"value\\":\\"aUNDdTEwMjgxOQ==\\"},{\\"option\\":\\"PRODUCT_OPTION\\",\\"value\\":\\"11\\"},{\\"option\\":\\"ACCOUNT_TYPE\\",\\"value\\":\\"\\"},{\\"option\\":\\"DETAIL_REQUEST\\",\\"value\\":\\"D\\"},{\\"option\\":\\"VENDOR\\",\\"value\\":\\"\\"},{\\"option\\":\\"VENDOR_VERSION\\",\\"value\\":\\"\\"},{\\"option\\":\\"BROKER_NUMBER\\",\\"value\\":\\"\\"},{\\"option\\":\\"END_USER\\",\\"value\\":\\"\\"},{\\"option\\":\\"FREEZE_KEY_PIN\\",\\"value\\":\\"\\"}],\\"kba\\":{\\"answers\\":{\\"outWalletAnswer1\\":\\"2\\",\\"outWalletAnswer2\\":\\"4\\",\\"outWalletAnswer3\\":\\"4\\",\\"outWalletAnswer4\\":\\"3\\"},\\"sessionId\\":\\"7XVCQTTMHTZW13NZFP2ZSFMS.pidd1v-191210153839711407154\\"}}}","user_action":"","tracking_number":"HGXQRZ7"}]},"coApplicants":[],"products":[{"product_name":"Free Checking","major_type":"CK","minor_type":"CKBA"},{"product_name":"Share Savings","major_type":"SAV","minor_type":"SREG"}],"fundingInfo":{"from_account_uuid":null,"payment_type":"ACH","is_using_external_processor":true,"opened_accounts":[{"account":{"unique_id":"0af4be6b-be26-4313-80d1-90a5dcc00f55","account_name":null,"account_number":"723216904","balance":100.0,"available_balance":null,"is_active":null,"product":{"product_name":"Free Checking","major_type":"CK","minor_type":"CKBA"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":100.0,"funding_source":"ACH"},{"account":{"unique_id":"034f9e3f-4c2b-4fe5-8a6f-eaccad29c890","account_name":null,"account_number":"723216894","balance":25.0,"available_balance":null,"is_active":null,"product":{"product_name":"Share Savings","major_type":"SAV","minor_type":"SREG"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":25.0,"funding_source":"ACH"}]},"reports":[],"app_status":"Completed","version":"3","external_crm_id":null}';
        AOApplicationRestRequest request = AOApplicationRestRequest.parse(testData);
        AOApplicationInfo appInfo = new AOApplicationInfo(request);

        // The payload above should only have one system_info response to keep this code lean.
        AOApplicationRestRequest.SystemInfo systemInfo = request.applicant.system_info[0];

        Test.startTest();

        AOExperianPreciseIDReportParser parser = new AOExperianPreciseIDReportParser();
        try {
            parser.parsePayload(systemInfo, appInfo);
        } catch(Exception e) {
            System.assert(false, 'Threw an exception: ' + e + ' stack trace: ' + e.getStackTraceString());
        }

        Test.stopTest();

        System.assertNotEquals(null, appInfo.kbaReport);
        System.assert(appInfo.kbaReport.containsKey(AOReportParser.REPORT_SUMMARY_KEY), 'Report summary should be present for the report.');
        System.assert(appInfo.kbaReport.containsKey(AOReportParser.REPORT_DATA_KEY), 'Report data should be present for the report.');

        List<Map<String, Object>> dataElements = (List<Map<String, Object>>)appInfo.kbaReport.get(AOReportParser.REPORT_DATA_KEY);
        System.assertNotEquals(null, dataElements);
        System.assertEquals(7, dataElements.size());
        System.assertEquals('Fraud Shield', dataElements[0].get(AOReportParser.REPORT_TITLE_KEY));
        System.assertEquals('OFAC', dataElements[1].get(AOReportParser.REPORT_TITLE_KEY));
        System.assertEquals('Date of Birth', dataElements[2].get(AOReportParser.REPORT_TITLE_KEY));
        System.assertEquals('KIQ Details', dataElements[3].get(AOReportParser.REPORT_TITLE_KEY));
        System.assertEquals('Address Details', dataElements[4].get(AOReportParser.REPORT_TITLE_KEY));
        System.assertEquals('Answers', dataElements[5].get(AOReportParser.REPORT_TITLE_KEY));
        System.assertEquals('Decision Reasons', dataElements[6].get(AOReportParser.REPORT_TITLE_KEY));
    }

    @IsTest
    private static void testError() {
        String testData = '{"form":{"name":"accountsandfunding","tracking_code":"T9FH3WF","job_reference_code":"PV4DHML"},"applicant":{"person":{"first_name":"Paul","last_name":"Ferguson","birth_date":"1958-01-01","tax_id":"666-37-1340","primary_address":{"line_1":"4400 Central Way","line_2":"Ste 510","city":"Chubbuck","state":"ID","country":"USA","postal_code":"83202"},"identification":{"type":"drivers_license","id_number":"101800775","issuing_authority":"CO","issue_date":"2018-01-01","expire_date":"2028-01-01"},"credit_score":{"score":null,"score_date":null},"home_phone":{"country_code":null,"phone_number":"3081231234","extension":null},"mobile_phone":{"country_code":null,"phone_number":null,"extension":null},"work_phone":{"country_code":null,"phone_number":null,"extension":null},"email":"dmagill@iccu.com"},"persona":"Unknown","membership_eligibility":"I\'m not a permanent resident, but am an employee, employer, student and/or retiree working in Idaho.","system_info":[{"system_name":"KBAQuestions","system_display_name":"Experian - KBA Questions","status":"DECLINE","decision":"DECLINE","everything":"{","user_action":"","tracking_number":"HGXQRZ7"}]},"coApplicants":[],"products":[{"product_name":"Free Checking","major_type":"CK","minor_type":"CKBA"},{"product_name":"Share Savings","major_type":"SAV","minor_type":"SREG"}],"fundingInfo":{"from_account_uuid":null,"payment_type":"ACH","is_using_external_processor":true,"opened_accounts":[{"account":{"unique_id":"0af4be6b-be26-4313-80d1-90a5dcc00f55","account_name":null,"account_number":"723216904","balance":100.0,"available_balance":null,"is_active":null,"product":{"product_name":"Free Checking","major_type":"CK","minor_type":"CKBA"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":100.0,"funding_source":"ACH"},{"account":{"unique_id":"034f9e3f-4c2b-4fe5-8a6f-eaccad29c890","account_name":null,"account_number":"723216894","balance":25.0,"available_balance":null,"is_active":null,"product":{"product_name":"Share Savings","major_type":"SAV","minor_type":"SREG"}},"from_account":{"unique_id":null,"account_name":null,"account_number":null,"balance":null,"available_balance":null,"is_active":null,"product":{"product_name":null,"major_type":null,"minor_type":null}},"funding_amount":25.0,"funding_source":"ACH"}]},"reports":[],"app_status":"Completed","version":"3","external_crm_id":null}';
        AOApplicationRestRequest request = AOApplicationRestRequest.parse(testData);
        AOApplicationInfo appInfo = new AOApplicationInfo(request);

        // The payload above should only have one system_info response to keep this code lean.
        AOApplicationRestRequest.SystemInfo systemInfo = request.applicant.system_info[0];

        Test.startTest();

        AOExperianPreciseIDReportParser parser = new AOExperianPreciseIDReportParser();
        try {
            parser.parsePayload(systemInfo, appInfo);
        } catch(Exception e) {
            System.assert(false, 'Threw an exception: ' + e + ' stack trace: ' + e.getStackTraceString());
        }

        Test.stopTest();

        System.assertNotEquals(null, appInfo.kbaReport);
        System.assert(appInfo.kbaReport.containsKey(AOReportParser.REPORT_DATA_KEY), 'Report data should be present for the report.');

        List<Map<String, Object>> dataElements = (List<Map<String, Object>>)appInfo.kbaReport.get(AOReportParser.REPORT_DATA_KEY);
        System.assertNotEquals(null, dataElements);
        System.assertEquals(2, dataElements.size());
        System.assertEquals('Error', dataElements[0].get(AOReportParser.REPORT_TITLE_KEY));
        System.assertEquals('Details', dataElements[1].get(AOReportParser.REPORT_TITLE_KEY));
    }

}